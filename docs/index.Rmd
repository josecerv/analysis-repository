---
title: "Rmarkdown Repository"
date: 'Updated `r format(Sys.Date(), "%B %d, %Y")`'
output:
  html_document:
    toc: yes
    toc_depth: 2
    fig_caption: true
header-includes:
  \renewcommand{\contentsname}{Items}
---

```{r setup, include=FALSE}
rm(list=ls())
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE,
	results = "hide"
)
library(aod)
library(car)
library(lmtest)
library(tidyverse)
library(gridExtra)
library(readxl)
library(dplyr)
library(tidyr)
library(janitor)
library(pander)
library(ggsignif)
library(extrafont)
library(googlesheets4)
library(stargazer)
library(sandwich)
library(lmtest)

```

# Data Simulation

```{r echo=TRUE, results="markdown"}
library(simstudy)

## define variables within the defData function
### dist = distribution
### formula = mean or probability
### variance = variance
### varname = variable name
def <- defData(varname = "age", dist = "normal", formula = 10,
    variance = 2)
def <- defData(def, varname = "female", dist = "binary",
    formula = "-2 + age * 0.1", link = "logit")
def <- defData(def, varname = "visits", dist = "poisson",
    formula = "1.5 - 0.2 * age + 0.5 * female", link = "log")
def <- defData(def, varname = "shots", dist = "poisson",
    formula = 3, variance = 1.5)
set.seed(123)
dd <- genData(1000, def)
head(dd, 20)
mean(dd$age) # should be near 10
sd(dd$age)^2 # should be close to 2
mean(dd$shots) # should be 3

## assigning treatment/control

## nTrt = number of treatments
## ratio = probabilities

study1 <- trtAssign(dd, nTrt = 2, balanced = TRUE, grpName = "TRT", ratio = c(0.5, 0.5))
head(study1, 10)

```

# Data cleaning

## Filtering
## Merging, Joining
## Mutating (efficiently)
## Validation (screening)
## Recoding

# Tables, Visualizations

## Demographics
## Balance Checks
## Bar Plots/Histograms
## Tables
## Stargazer

# Analysis

## Linear Models (OLS, GLM)
### Multivariate Regression
```{r Multivariate Regression}
#Mreg <-lm(cbind(DV, IV1, IV2)~ Control1 + Control2, data = data)
#summary(Mreg)
```

### Hierarchical Regression
```{r Hierarchical Regression}
# Model1 <- lm(DV~IV1 + IV2, data = data)
# Model2 <- lm(DV~IV1 + IV2 + Control1 + Control2, data = data)
# Model3 <- lm(DV~IV1 + IV2 + Control1 + Control2 + Control3 + Control4, data = data)
# Model4 <- lm(DV~IV1 + IV2 + Control1 + Control2 + Control3 + Control4 + Control5, data = data)
```

```{r echo=TRUE}
# robust standard errors
se_robust <- function(model)
  coeftest(model, vcov = vcovHC(model, "HC0")) 
```

## Mediation
## Power Analysis
## Bootstrapping, Simulation
## Model Estimations (coefficient testing)
## Seemingly Unrelated Regressions (testing other models)

# Functional programming

## Programming with dply verbs
## Function factories
## Applications for Analysis
### Cleaning
### Visualization
### Tables

```{r echo=TRUE, results="markdown"}
 power_n <- function(exp) {
   function(x) {
     x ^ exp
   }
 }

 names <- list(
   square = 2,
   cube = 3,
   root = 1/2,
   cuberoot = 1/3,
   reciprocal = -1
 )
 funs <- purrr::map(names, power_n)

 funs$root(64)
 funs$square(64)
 funs$cuberoot(64)
```